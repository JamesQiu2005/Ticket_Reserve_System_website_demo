{% extends "base.html" %}

{# 1) Load Bootstrap CSS early #}
{% block head %}
  {{ super() }}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h3 class="mb-0 text-center">Track My Spending</h3>
    </div>
    <div class="card-body">
      <!-- Filter Form -->
      <form method="GET" action="{{ url_for('customer_spending') }}" class="row g-3 mb-4">
        <div class="col-md-5">
          <label for="start_date" class="form-label">Start Date</label>
          <input
            type="date"
            class="form-control"
            id="start_date"
            name="start_date"
            value="{{ request.args.get('start_date','') }}"
          />
        </div>
        <div class="col-md-5">
          <label for="end_date" class="form-label">End Date</label>
          <input
            type="date"
            class="form-control"
            id="end_date"
            name="end_date"
            value="{{ request.args.get('end_date','') }}"
          />
        </div>
        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-primary mt-4">View Spending</button>
        </div>
      </form>

      <hr>

      <!-- Total Spending -->
      <p class="fs-5 text-center">
        Total Amount Spent: <strong>{{ total_spent }}</strong>
      </p>

      <!-- Monthly Spending Table -->
      <h3 class="mt-4">Monthly Spending</h3>
      {% if months and monthly_spent %}
        <div class="table-responsive">
          <table id="spending-table" class="table table-striped table-hover align-middle" style="width:100%">
            <thead class="table-dark">
              <tr>
                <th>Month</th>
                <th>Amount Spent</th>
              </tr>
            </thead>
            <tbody>
              {% for i in range(months|length) %}
              <tr>
                <td>{{ months[i] }}</td>
                <td>{{ '%.2f'|format(monthly_spent[i]) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-warning text-center">
          No monthly spending data available.
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{# 2) Load jQuery and init script at the bottom #}
{% block scripts %}
  {{ super() }}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      $('#spending-table').DataTable({
        paging:    false,
        info:      false,
        ordering:  true,
        searching: false,
        autoWidth: false, // Ensures proper column alignment
        responsive: true  // Makes the table responsive
      });
    });
  </script>
{% endblock %}
